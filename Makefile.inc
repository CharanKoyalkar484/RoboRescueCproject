QT_LIB_DIR 						= C:/Qt/Qt5.4.2/5.4/mingw491_32/lib
QT_INCL_DIR 					= C:/Qt/Qt5.4.2/5.4/mingw491_32/include
QT_BIN_DIR 						= C:/Qt/Qt5.4.2/5.4/mingw491_32/bin
ifeq ($(OS),Windows_NT)
	BOOST_LIB_DIR 					= C:/Boost/boost_1_58_0/stage/lib
	BOOST_INCL_DIR 					= C:/Boost/boost_1_58_0
else
	BOOST_LIB_DIR 					= 
	BOOST_INCL_DIR 					= 
endif

ifeq ($(OS),Windows_NT)
	CXX 							= g++
	CXXFLAGS						= -std=c++11
	LDFLAGS							= -L$(QT_LIB_DIR) -L$(BOOST_LIB_DIR)
	INCLUDES 						= -I$(QT_INCL_DIR) -I$(BOOST_INCL_DIR) -IDeps/incl/mavlink
	LDLIBS							= -lQt5Core -lQt5Widgets -lQt5Gui -lQt5OpenGL
else
	CXX 							= g++-4.9
	CXXFLAGS						= -std=c++11
	LDFLAGS							= -L$(QT_LIB_DIR)
	INCLUDES 						= -I$(QT_INCL_DIR) -IDeps/incl/mavlink `pkg-config --cflags opencv`
	LDLIBS							= -lboost_system -lpthread `pkg-config --libs opencv` -lX11
endif

SRC 							= 
UI 								= 
UI_HEADERS						=
MODULES 						=
MOC								= $(QT_BIN_DIR)/moc.exe
UIC								= $(QT_BIN_DIR)/uic.exe

#######LIBRARIES#######
DONAHOO_LIB						= deps/incl/Donahoo/
MAVLINK_LIB						= deps/incl/mavlink/
CIMG_LIB						= deps/incl/CImg/
ARUCO_LIB						= deps/incl/aruco/

########MODULES########
#GUI
MAIN_GUI_MODULE 				= Src/GUI/mission-gui/
QUADCOPTER_GUI_MODULE 			= Src/GUI/mission-gui/quadcopter-gui/
ATV_GUI_MODULE 					= Src/GUI/mission-gui/ATV-gui/
ROSBEE_GUI_MODULE 				= Src/GUI/mission-gui/rosbee-gui/
LIDAR_GUI_MODULE 				= Src/GUI/mission-gui/lidar-gui/
MAP_GUI_MODULE 					= Src/GUI/mission-gui/map-gui/

#VEHICLES
QUADCOPTER_MODULE				= Src/Vehicles/Quadcopter/
ATV_MODULE						= Src/Vehicles/ATV/
ROSBEE_LOCAL_MODULE				= Src/Vehicles/Rosbee/

#SENSORS
PROPELLOR_ENCODER_MODULE 		= Src/Sensors/Propellor-Encoder/
PROPELLOR_SIRC_MODULE			= Src/Sensors/Propellor-SIRC/
PROPELLOR_TEMPERATURE_MODULE 	= Src/Sensors/Propellor-TemperatureSensor/
PROPELLOR_ULTRASONIC_MODULE		= Src/Sensors/Propellor-UltrasonicSensor/
LIDAR_BASESTATION_MODULE		= Src/Sensors/lidar/LIDAR-Basestation/
PX4FLOW_MODULE 					= src/sensors/PX4Flow/
INTERFACES_MODULE 				= src/sensors/Interfaces/
LOCALISATION_SERVER				= src/sensors/Localisation-Module/Localisation_Server/

#COMMUNICATION
MAVLINK_EXCHANGER_MODULE		= src/communication/MavlinkExchanger/
SERIAL_PORT_MODULE				= src/communication/SerialPort/
UDP_MODULE						= Src/Communication/udp/
UDP_LINUX_MODULE				= Src/Communication/udp/Linux-UDP/

#MODULES
MISSION1_MODULE					= Src/Modules/Mission1/
LOCALISATION_MODULE_MODULE		= src/Modules/Localisationmodule/

#TARGET MODULES
ROBORESCUE_MISSION1				= $(MISSION1_MODULE) 
ROBORESCUE_MISSION1			   += $(MAIN_GUI_MODULE)
ROBORESCUE_MISSION1			   += $(QUADCOPTER_GUI_MODULE)
ROBORESCUE_MISSION1			   += $(ATV_GUI_MODULE)
ROBORESCUE_MISSION1			   += $(ROSBEE_GUI_MODULE)
ROBORESCUE_MISSION1			   += $(LIDAR_GUI_MODULE)
ROBORESCUE_MISSION1			   += $(QUADCOPTER_MODULE)
ROBORESCUE_MISSION1			   += $(ATV_MODULE)
ROBORESCUE_MISSION1			   += $(MAVLINK_EXCHANGER_MODULE)
ROBORESCUE_MISSION1			   += $(SERIAL_PORT_MODULE)
ROBORESCUE_MISSION1			   += $(UDP_MODULE)
ROBORESCUE_MISSION1			   += $(ROSBEE_LOCAL_MODULE)
ROBORESCUE_MISSION1			   += $(LIDAR_BASESTATION_MODULE)

#LOCALISATION MODULES
ROBORESCUE_LOCALISATION_MODULE  = $(PX4FLOW_MODULE)
ROBORESCUE_LOCALISATION_MODULE += $(INTERFACES_MODULE)
ROBORESCUE_LOCALISATION_MODULE += $(LOCALISATION_MODULE_MODULE)
ROBORESCUE_LOCALISATION_MODULE += $(LOCALISATION_SERVER)
ROBORESCUE_LOCALISATION_MODULE += $(ARUCO_LIB)
ROBORESCUE_LOCALISATION_MODULE += $(MAVLINK_EXCHANGER_MODULE)
ROBORESCUE_LOCALISATION_MODULE += $(SERIAL_PORT_MODULE)
INCLUDES += -I$(MAVLINK_LIB)
INCLUDES += -I$(CIMG_LIB)

#ROSBEE MODULES
ROBORESCUE_ROSBEE				= $(ROSBEE_LOCAL_MODULE)
ROBORESCUE_ROSBEE 				+= $(UDP_MODULE)
ROBORESCUE_ROSBEE				+= $(LIDAR_BASESTATION_MODULE)

#LIDAR MODULES
ROBORESCUE_LIDAR				= $(LIDAR_BASESTATION_MODULE)
ROBORESCUE_LIDAR 				+= $(UDP_MODULE)
ROBORESCUE_LIDAR 				+= $(ROSBEE_LOCAL_MODULE)
ROBORESCUE_LIDAR				+= $(SERIAL_PORT_MODULE)
ROBORESCUE_LIDAR				+= $(UDP_LINUX_MODULE)

#CLEAN MODULES
CLEAN_MODULES					 = $(MISSION1_MODULE) 
CLEAN_MODULES			   		+= $(DONAHOO_LIB)
CLEAN_MODULES			   		+= $(MAVLINK_LIB)
CLEAN_MODULES			   		+= $(CIMG_LIB)
CLEAN_MODULES			   		+= $(ARUCO_LIB)
CLEAN_MODULES			   		+= $(MAIN_GUI_MODULE)
CLEAN_MODULES			   		+= $(QUADCOPTER_GUI_MODULE)
CLEAN_MODULES			   		+= $(ATV_GUI_MODULE)
CLEAN_MODULES			   		+= $(ROSBEE_GUI_MODULE)
CLEAN_MODULES			   		+= $(LIDAR_GUI_MODULE)
CLEAN_MODULES			   		+= $(MAP_GUI_MODULE)
CLEAN_MODULES			   		+= $(QUADCOPTER_MODULE)
CLEAN_MODULES			  		+= $(ATV_MODULE)
CLEAN_MODULES			  		+= $(ROSBEE_LOCAL_MODULE)
CLEAN_MODULES			  		+= $(PROPELLOR_ENCODER_MODULE)
CLEAN_MODULES			  		+= $(PROPELLOR_SIRC_MODULE)
CLEAN_MODULES			  		+= $(PROPELLOR_TEMPERATURE_MODULE)
CLEAN_MODULES			  		+= $(PROPELLOR_ULTRASONIC_MODULE)
CLEAN_MODULES			   		+= $(LIDAR_LOCAL_MODULE)
CLEAN_MODULES			   		+= $(LIDAR_BASESTATION_MODULE)
CLEAN_MODULES			   		+= $(PX4FLOW_MODULE)
CLEAN_MODULES			   		+= $(LOCALISATION_SERVER)
CLEAN_MODULES			   		+= $(MAVLINK_EXCHANGER_MODULE)
CLEAN_MODULES			   		+= $(SERIAL_PORT_MODULE)
CLEAN_MODULES					+= $(UDP_MODULE)
CLEAN_MODULES			   		+= $(MISSION1_MODULE)
CLEAN_MODULES					+= $(LOCALISATION_MODULE_MODULE)




ifeq ($(MAKECMDGOALS),mission1)
	MODULES += $(ROBORESCUE_MISSION1)
endif
ifeq ($(MAKECMDGOALS),localisationmodule)
	MODULES += $(ROBORESCUE_LOCALISATION_MODULE)
endif
ifeq ($(MAKECMDGOALS),lidar)
	MODULES += $(ROBORESCUE_LIDAR)
endif
ifeq ($(MAKECMDGOALS),rosbee)
	MODULES += $(ROBORESCUE_ROSBEE)
endif

INCLUDES 	+= $(patsubst %, -I%, $(MODULES))
include $(MODULES:=module.mk)
UI_HEADERS 	+= $(UI:.ui=.h)
OBJ 		+= $(SRC:.cpp=.o)

%.d : %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -MM -MT"$@" $< -MF $@
	
%.o : %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -o $@ -c $<
	
moc_%.cpp : %.h
	$(MOC) $< -o $@
	
ui_%.h : %.ui
	$(UIC) $< -o $@
